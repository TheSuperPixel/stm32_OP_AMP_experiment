# stm32运放实验演示电路
## 简介
这是stm32运放实验演示电路，我把许多常用运放电路集成到了一个板子上，通过拨码开关来改变不同电阻大小挡位，通过转动旋钮可调节输入电压大小。然后使用运放前级处理电路，把电压映射到0-3.3V，用stm32读取电压信息，通过线性运算算出原本电压，并显示到oled上，能通过OLED显示内容直观了解和学习运放的输入输出电压关系。因为电路设计，运放精度偏差，ADC调理电路和电源质量限制,实际上OLED显示的内容和公式有一定偏差,但是大致关系是正确的。这个电路仅用于演示运放能用于计算的特性，不用于实际的信号处理。
## 演示视频
https://www.bilibili.com/video/BV1tPsaeoEXa
## 硬件组装调试说明
### 1.PCB打板
pcb文件位于 **./pcb** 文件夹下，内有5张pcb文件，Board1是最终版本电路的左边部分，Board2是最终版本电路的中间部分，Board4是最终版本电路的右边部分，其余两张电路板，也就是Board3和Board_all，是上一版本的文件，在最新版运放实验演示电路中，已经不需要了，最后只需打板Board1，Board2和Board4即可。
### 2.Board1焊接制作
Board1的所有运放芯片需要焊接**LM358**或引脚定义相同的运放，不能按照原本的电路图焊接LM393，旋转电位器旋钮建议使用1K以上的阻值，否则会因为电流过大造成发热和过载。其余元件按照原理图设计焊接即可。
### 3.Board2焊接制作
Board2的所有运放芯片需要焊接**LM358**或引脚定义相同的运放，不能按照原本的电路图焊接LM393；**R127**,**R129**和**R131**使用0欧电阻焊接，**R128**,**R130**和**R132**不焊接。旋转电位器旋钮建议使用1K以上的阻值，否则会因为电流过大造成发热和过载。其余元件按照原理图设计焊接即可。
### 4.Board4焊接制作
1.Board4左上角**U23**焊接排母；左下方**H4**和**H5**焊接排母，并按照视频内容正确插入与视频对应型号的正负双电源供电板。输出电压调整到**正负10V**。
2.给Board4通电，然后往Board4边缘的IN0连接直流电源。调整Board4右边运放前级处理电路的六个电位器进行校准，使得当IN0输入-10V到10V电压时，运放前级处理电路能把电压映射到0-3.3V。按照这个方法校准IN1和IN2的前级处理电路的电位器。最后，给Board4左上角**U23**按照视频内容正确插入与视频对应型号的stm32f103c8t6最小系统板。
3.把Board4的**sw33**，**sw34**和**sw35**拨到最下面，然后再次给Board4通电，通过控制五向开关，进入菜单的设置页面，调整k1,b1,k2,b2,k3,b3，使得当IN0，IN1，IN2输入-10V到10V电压时，stm32能够显示出和输入电压一样的数值。
### 5.整机调试
使用激光切割机切割出 **./3D模型/底板打印.DWG**形状的文件，厚度选择为3mm。然后，使用铜柱和螺丝，把焊接好的Board1，Board2和Board4依次从左往右安装，把板子摆到水平方向，两块相邻的pcb边缘的排针使用跳线帽横向进行连接。
## 使用方法
开机后，使用五向开关控制菜单进入**start**页面，可以直观查看输入电压，输出电压和对应的电压波形。通过转动旋钮可调节输入电压大小，通过拨码开关来改变不同电阻大小挡位。Board2的**sw28**、**sw29**和**sw30**用于控制不同运放输入输出电路和stm32电压测量的连接关系。如果**sw28**、**sw29**和**sw30**都只有1所在的那位拨到开启状态，则stm32测量的是反相比例器的输入和输出电压；如果**sw28**、**sw29**和**sw30**都只有2所在的那位拨到开启状态，则stm32测量的是同相比例器的输入和输出电压。更多拨码含义见下表：
```
1：反相比例器
2：同相比例器
3：同相加法器
4：反相加法器
5：减法器
6：仪用放大器
7：积分器
8：微分器
```
## 参考资料和其他
1.stm32代码部分主要参考了江协科技的ADC多通道输入实验
https://www.bilibili.com/video/BV1th411z7sn
2.由于ADC前级调理电路设计缺陷，在电路刚上电时，ADC前级调理电路的输出会有超出0-3.3V以外的冲击电压，会影响stm32正常工作，因此，建议在通电前先把stm32取下，通电一段时间后再插回stm32。断电时同理。
3.电路的大部分设计(包含仿真)是2023年大二上刚学习模电的时候做的，难免会有不足之处，请大家见谅。